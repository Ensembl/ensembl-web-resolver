{% import "shared/url.html" as url_helper %}

<div class="redirect-content">
    <div class="redirect-info">
        <div class="search-param">
            <span class="search-param-label">Gene</span>
            <span class="search-param-value">{{ response.stable_id }}</span>
        </div>
        {% if response.code == 404 and response.message %}
            <div class="error-message">
                {{ response.message }}
            </div>
            {{ url_helper.render_url("Go to", "https://beta.ensembl.org/species-selector") }}
        {% else %}
            {% for item in response.content %}
                <div class="id-detail-container">
                    <span class="id-detail">{{ item.common_name }},</span>
                    <span class="id-detail id-detail-margin-left id-detail-italic">{{ item.scientific_name }},</span>
                    <span class="id-detail id-detail-margin-left id-detail-italic">
                        {% if item.type and item.is_reference %}
                          {{ item.type.kind }} - {{ item.type.value }}, Reference
                        {% elif item.is_reference %}
                          Reference
                        {% elif item.type %}
                          {{ item.type.kind }} - {{ item.type.value }}
                        {% else %}
                          -
                        {% endif %}
                        ,
                    </span>
                    <span class="id-detail id-detail-margin-left">{{ item.assembly.name }},</span>
                    <span class="id-detail id-detail-margin-left id-detail-tooltip">{{ item.assembly.accession_id }}</span>
                </div>
                <div id="tooltip" style="display:none; position:absolute;">
                    <div class="tooltip-content">
                        <span class="tooltip-content-title">View in</span>
                        <span class="tooltip-links">
                            <a href="{{ item.genome_browser_url }}">
                                {% include "shared/_genome_browser.html" %}
                            </a>
                        </span>
                        <span class="tooltip-links">
                            <a href="{{ item.entity_viewer_url }}">
                                {% include "shared/_entity_viewer.html" %}
                            </a>
                        </span>
                    </div>
                    <div class="tooltip-arrow"></div>
                </div>
            {% endfor %}
        {% endif %}
    </div>
    <div class="redirect-text">
        <span>
            You will be redirected to the new Ensembl website, where you will find the latest genomic information
        </span>
    </div>
</div>

<script>
    document.querySelectorAll('.id-detail-container').forEach(function(el) {
      el.addEventListener('click', function(e) {
        e.stopPropagation();
        var tooltip = document.getElementById('tooltip');
        var target = el.querySelector('.id-detail-tooltip');
        tooltip.style.display = 'block';
        var rect = target.getBoundingClientRect();
        tooltip.style.top = (rect.top - 20) + 'px';
        tooltip.style.left = (rect.right + 10 + window.scrollX) + 'px';
      });
    });

    document.addEventListener('click', function(e) {
      var tooltip = document.getElementById('tooltip');
      if (!e.target.closest('.id-detail-container') && !e.target.closest('#tooltip')) {
        tooltip.style.display = 'none';
      }
    });
</script>
